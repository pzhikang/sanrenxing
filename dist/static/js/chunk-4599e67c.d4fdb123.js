(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4599e67c"],{"2f79":function(e,r,t){"use strict";t("f1ea")},"9ed6":function(e,r,t){"use strict";t.r(r);var s=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"page-container"},[t("div",{staticClass:"login-form"},[t("h2",[e._v("登录")]),t("form",{on:{submit:function(r){return r.preventDefault(),e.handleLogin(r)}}},[t("div",{staticClass:"qrcode-and-inputs",staticStyle:{"margin-top":"30px"}},[t("div",{staticClass:"qrcode-area"}),t("div",{staticClass:"input-group-container"},[t("div",{staticClass:"input-group"},[t("label",{attrs:{for:"login-name"}}),t("div",{staticClass:"input-icon"},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 16 16"}},[t("path",{attrs:{fill:"#dcdcdc","fill-rule":"evenodd",d:"M12 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 4 12.5v-9A1.5 1.5 0 0 1 5.5 2h5A1.5 1.5 0 0 1 12 3.5m-1.5-3a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3zM6.25 11a.75.75 0 0 0 0 1.5h3.5a.75.75 0 0 0 0-1.5z","clip-rule":"evenodd"}})])]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],attrs:{type:"text",id:"login-name",placeholder:"请输入用户名"},domProps:{value:e.username},on:{input:function(r){r.target.composing||(e.username=r.target.value)}}})]),t("div",{staticClass:"input-group"},[t("label",{attrs:{for:"login-password"}}),t("div",{staticClass:"input-icon"},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"}},[t("rect",{attrs:{width:"14",height:"10",x:"5",y:"11",fill:"#dcdcdc",rx:"2"}}),t("path",{attrs:{fill:"#dcdcdc","fill-rule":"evenodd",d:"M9.5 6.75a.25.25 0 0 0-.25.25v5h-1.5V7c0-.966.784-1.75 1.75-1.75h5c.966 0 1.75.784 1.75 1.75v5h-1.5V7a.25.25 0 0 0-.25-.25z","clip-rule":"evenodd"}})])]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{type:"password",id:"login-password",placeholder:"请输入密码"},domProps:{value:e.password},on:{input:function(r){r.target.composing||(e.password=r.target.value)}}})])])]),t("div",{staticClass:"remember-me"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.remember,expression:"remember"}],attrs:{type:"checkbox",id:"remember"},domProps:{checked:Array.isArray(e.remember)?e._i(e.remember,null)>-1:e.remember},on:{change:function(r){var t=e.remember,s=r.target,a=!!s.checked;if(Array.isArray(t)){var o=null,i=e._i(t,o);s.checked?i<0&&(e.remember=t.concat([o])):i>-1&&(e.remember=t.slice(0,i).concat(t.slice(i+1)))}else e.remember=a}}}),t("label",{staticClass:"remember-label",attrs:{for:"remember"}},[e._v("记住密码")]),t("span",{staticClass:"register-link",on:{click:e.openRegisterModal}},[e._v("注册")])]),t("div",{staticClass:"agreement-text"},[t("div",{staticClass:"agreement-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.isAgreed,expression:"isAgreed"}],attrs:{type:"checkbox",id:"agree-login"},domProps:{checked:Array.isArray(e.isAgreed)?e._i(e.isAgreed,null)>-1:e.isAgreed},on:{change:function(r){var t=e.isAgreed,s=r.target,a=!!s.checked;if(Array.isArray(t)){var o=null,i=e._i(t,o);s.checked?i<0&&(e.isAgreed=t.concat([o])):i>-1&&(e.isAgreed=t.slice(0,i).concat(t.slice(i+1)))}else e.isAgreed=a}}}),e._m(0)])]),t("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("登录")]),e.error?t("div",{staticClass:"error-message"},[t("p",[e._v(e._s(e.error.message))])]):e._e()])]),e.isRegisterModalOpen?t("div",{staticClass:"modal-overlay register-modal",on:{click:e.closeRegisterModal}},[t("div",{staticClass:"modal-content",on:{click:function(e){e.stopPropagation()}}},[t("button",{staticClass:"close-icon",on:{click:e.closeRegisterModal}},[e._v("×")]),t("h2",[e._v("注册")]),t("form",{on:{submit:function(r){return r.preventDefault(),e.handleRegister(r)}}},[t("div",{staticClass:"input-group"},[t("label",{attrs:{for:"register-username"}}),t("div",{staticClass:"input-icon-register"},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 16 16"}},[t("path",{attrs:{fill:"#dcdcdc","fill-rule":"evenodd",d:"M12 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 4 12.5v-9A1.5 1.5 0 0 1 5.5 2h5A1.5 1.5 0 0 1 12 3.5m-1.5-3a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3h-5a3 3 0 0 1-3-3v-9a3 3 0 0 1 3-3zM6.25 11a.75.75 0 0 0 0 1.5h3.5a.75.75 0 0 0 0-1.5z","clip-rule":"evenodd"}})])]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.registerUsername,expression:"registerUsername"}],attrs:{type:"text",id:"register-username",placeholder:"请输入用户名"},domProps:{value:e.registerUsername},on:{input:function(r){r.target.composing||(e.registerUsername=r.target.value)}}})]),t("div",{staticClass:"input-group"},[t("label",{attrs:{for:"register-password"}}),t("div",{staticClass:"input-icon-register"},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"}},[t("rect",{attrs:{width:"14",height:"10",x:"5",y:"11",fill:"#dcdcdc",rx:"2"}}),t("path",{attrs:{fill:"#dcdcdc","fill-rule":"evenodd",d:"M9.5 6.75a.25.25 0 0 0-.25.25v5h-1.5V7c0-.966.784-1.75 1.75-1.75h5c.966 0 1.75.784 1.75 1.75v5h-1.5V7a.25.25 0 0 0-.25-.25z","clip-rule":"evenodd"}})])]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.registerPassword,expression:"registerPassword"}],attrs:{type:"password",id:"register-password",placeholder:"请输入密码(8-12位)"},domProps:{value:e.registerPassword},on:{input:[function(r){r.target.composing||(e.registerPassword=r.target.value)},e.validatePassword]}}),e.passwordValid?e._e():t("div",{staticClass:"password-error-hint"},[e._v(" "+e._s(e.passwordErrorMessage)+" ")])]),t("div",{staticClass:"input-group"},[t("label",{attrs:{for:"confirm-password"}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.confirmPassword,expression:"confirmPassword"}],attrs:{type:"password",id:"confirm-password",placeholder:"请确认密码"},domProps:{value:e.confirmPassword},on:{input:function(r){r.target.composing||(e.confirmPassword=r.target.value)}}})]),t("div",{staticClass:"role-selection"},[t("h3",[e._v("选择身份")]),t("button",{staticClass:"role-btn",class:{selected:"student"===e.selectedRole},attrs:{type:"button"},on:{click:function(r){return e.selectRole("student")}}},[e._v("学生")]),t("button",{staticClass:"role-btn",class:{selected:"teacher"===e.selectedRole},attrs:{type:"button"},on:{click:function(r){return e.selectRole("teacher")}}},[e._v("教师")])]),t("div",{staticClass:"agreement-text-register"},[t("div",{staticClass:"agreement-checkbox"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.isAgreed,expression:"isAgreed"}],attrs:{type:"checkbox",id:"agree-register"},domProps:{checked:Array.isArray(e.isAgreed)?e._i(e.isAgreed,null)>-1:e.isAgreed},on:{change:function(r){var t=e.isAgreed,s=r.target,a=!!s.checked;if(Array.isArray(t)){var o=null,i=e._i(t,o);s.checked?i<0&&(e.isAgreed=t.concat([o])):i>-1&&(e.isAgreed=t.slice(0,i).concat(t.slice(i+1)))}else e.isAgreed=a}}}),e._m(1)])]),t("button",{staticClass:"submit-btn",attrs:{type:"submit"}},[e._v("提交")])])])]):e._e()])},a=[function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("span",[e._v(" 点击同意"),t("a",{staticClass:"agreement-link",attrs:{href:"/user-agreement"}},[e._v("《用户使用协议》")]),e._v(" 和 "),t("a",{staticClass:"agreement-link",attrs:{href:"/user-notice"}},[e._v("《用户使用须知》")])])},function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("span",[e._v(" 点击同意"),t("a",{staticClass:"agreement-link",attrs:{href:"/user-agreement"}},[e._v("《用户使用协议》")]),e._v(" 和 "),t("a",{staticClass:"agreement-link",attrs:{href:"/user-notice"}},[e._v("《用户使用须知》")])])}],o=t("c7eb"),i=t("1da1"),n=(t("d3b7"),t("25f0"),t("bc3a")),l=t.n(n),c={name:"Login",data:function(){return{passwordValid:!0,passwordErrorMessage:"",username:"",password:"",remember:!1,isAgreed:!1,isRegisterModalOpen:!1,registerUsername:"",registerPassword:"",confirmPassword:"",error:null,selectedRole:""}},mounted:function(){this.checkRememberedUser()},watch:{$route:{handler:function(e){this.redirect=e.query&&e.query.redirect},immediate:!0}},methods:{validatePassword:function(){var e=this.registerPassword.length;0===e?(this.passwordValid=!0,this.passwordErrorMessage=""):e<8?(this.passwordValid=!1,this.passwordErrorMessage="密码不能少于8位"):e>12?(this.passwordValid=!1,this.passwordErrorMessage="密码不能超过12位"):(this.passwordValid=!0,this.passwordErrorMessage="")},checkRememberedUser:function(){localStorage.getItem("remember")&&(this.username=localStorage.getItem("username"),this.password=localStorage.getItem("password"),this.remember=!0)},openRegisterModal:function(){this.isRegisterModalOpen=!0},closeRegisterModal:function(){this.isRegisterModalOpen=!1},handleLogin:function(){var e=this;return Object(i["a"])(Object(o["a"])().mark((function r(){var t,s,a,i,n;return Object(o["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.isAgreed){r.next=3;break}return alert("请先同意用户协议和须知"),r.abrupt("return");case 3:return r.prev=3,r.next=6,l.a.post("https://sanrenxing.wihealth.com.cn/Login/login_by_phone/",{username:e.username,password:e.password});case 6:t=r.sent,200===t.status&&"登录成功"===t.data.message?(console.log("登录成功，收到的数据：",t.data),s=t.data,a=s.role,i=s.id,n=i.toString(),console.log("拼接后的 student_id:",n),console.log("保存到 localStorage 的 student_id:",localStorage.getItem("student_id")),localStorage.setItem("student_id",n),localStorage.setItem("role",a),localStorage.setItem("token",t.data.token),e.storeTokens(t.data),e.$router.push({path:"/wenda"}),console.log("登录成功，跳转到主页")):e.error={message:"登录失败，请检查用户名和密码"},r.next=13;break;case 10:r.prev=10,r.t0=r["catch"](3),e.error={message:"登录失败，请稍后再试"};case 13:case"end":return r.stop()}}),r,null,[[3,10]])})))()},storeTokens:function(e){console.log("storeTokens 被调用，传入的 data:",e),localStorage.setItem("token",e.token),localStorage.setItem("refreshToken",e.refreshToken),console.log("token 已存入 localStorage:",localStorage.getItem("token")),console.log("refreshToken 已存入 localStorage:",localStorage.getItem("refreshToken")),this.remember?(localStorage.setItem("username",this.username),localStorage.setItem("password",this.password),localStorage.setItem("remember",!0),console.log("username 已存入 localStorage:",localStorage.getItem("username")),console.log("password 已存入 localStorage:",localStorage.getItem("password")),console.log("remember 已存入 localStorage:",localStorage.getItem("remember"))):(localStorage.removeItem("username"),localStorage.removeItem("password"),localStorage.removeItem("remember"),console.log("username 已从 localStorage 移除"),console.log("password 已从 localStorage 移除"),console.log("remember 已从 localStorage 移除"))},selectRole:function(e){this.selectedRole=e},handleRegister:function(){var e=this;return Object(i["a"])(Object(o["a"])().mark((function r(){var t;return Object(o["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e.validatePassword(),e.passwordValid){r.next=3;break}return r.abrupt("return");case 3:if(e.isAgreed){r.next=6;break}return alert("请先同意用户协议和须知"),r.abrupt("return");case 6:if(e.registerUsername&&e.registerPassword&&e.confirmPassword){r.next=9;break}return alert("请填写所有字段"),r.abrupt("return");case 9:if(e.registerPassword===e.confirmPassword){r.next=12;break}return alert("密码和确认密码不一致，请重新输入。"),r.abrupt("return");case 12:if(e.selectedRole){r.next=15;break}return alert("请选择身份"),r.abrupt("return");case 15:return console.log("注册请求参数:",{username:e.registerUsername,password:e.registerPassword,role:e.selectedRole}),r.prev=16,r.next=19,l.a.post("http://182.92.182.44:8001/Login/RegisterView/",{username:e.registerUsername,password:e.registerPassword,role:e.selectedRole});case 19:t=r.sent,201===t.status?(alert("注册成功！请登录"),e.username=e.registerUsername,e.password=e.registerPassword,localStorage.setItem("role",e.selectedRole),e.closeRegisterModal()):e.error={message:"注册失败，请稍后再试"},r.next=26;break;case 23:r.prev=23,r.t0=r["catch"](16),e.error={message:"注册失败，请稍后再试"};case 26:case"end":return r.stop()}}),r,null,[[16,23]])})))()}}},d=c,m=(t("2f79"),t("2877")),g=Object(m["a"])(d,s,a,!1,null,"99708bf2",null);r["default"]=g.exports},f1ea:function(e,r,t){}}]);