(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5036a6fe"],{"04cd":function(e,t,o){"use strict";o("ccd0")},"7db0":function(e,t,o){"use strict";var n=o("23e7"),s=o("b727").find,r=o("44d2"),a=o("ae40"),c="find",i=!0,l=a(c);c in[]&&Array(1)[c]((function(){i=!1})),n({target:"Array",proto:!0,forced:i||!l},{find:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),r(c)},ccd0:function(e,t,o){},db07:function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[e.selectedCourse?o("div",[e.questions.length>0?o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.questions},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"55"}}),o("el-table-column",{attrs:{prop:"question",label:"题目"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticStyle:{color:"black"}},[o("div",[e._v(e._s(t.row.question))]),o("div",[e._v("A. "+e._s(t.row.A||"暂无选项"))]),o("div",[e._v("B. "+e._s(t.row.B||"暂无选项"))]),o("div",[e._v("C. "+e._s(t.row.C||"暂无选项"))]),o("div",[e._v("D. "+e._s(t.row.D||"暂无选项"))]),o("div",[e._v("答案："+e._s(t.row.answer))]),o("div",[e._v("解析："+e._s(t.row.analysis||"暂无解析"))])])]}}],null,!1,4244452858)})],1):e._e()],1):o("div",[o("el-card",{staticClass:"course-selection"},[e._l(e.courseNames,(function(t,n){return o("el-button",{key:n,staticClass:"course-button",on:{click:function(o){return e.selectCourse(t)}}},[e._v(" "+e._s(t)+"的习题 ")])})),o("el-button",{staticClass:"course-button",on:{click:function(t){e.showUploadDialog=!0}}},[e._v(" 自定义上传 ")]),o("el-button",{staticClass:"saved-button",attrs:{type:"primary"},on:{click:e.goToSaved}},[e._v("已存题库")])],2)],1),o("div",{directives:[{name:"show",rawName:"v-show",value:e.showUploadDialog,expression:"showUploadDialog"}],staticClass:"upload-dialog"},[o("div",{staticClass:"upload-content"},[o("h2",[e._v("上传PDF文件并生成题目")]),o("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"课程名称"}},[o("el-select",{attrs:{placeholder:"请选择课程"},on:{change:e.updateCourseId},model:{value:e.form.course_name,callback:function(t){e.$set(e.form,"course_name",t)},expression:"form.course_name"}},e._l(e.courseNames,(function(e,t){return o("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),o("el-form-item",{attrs:{label:"上传PDF文件"}},[o("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{"auto-upload":!1,"on-change":e.handleFileChange,limit:1,accept:".pdf"}},[o("div",{staticStyle:{display:"flex","justify-content":"flex-start"}},[o("el-button",{staticStyle:{width:"150px"},attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")])],1),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传PDF文件")])])],1),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("提交")]),o("el-button",{on:{click:function(t){e.showUploadDialog=!1}}},[e._v("关闭")])],1)],1)],1)])])},s=[],r=o("c7eb"),a=o("b85c"),c=o("1da1"),i=o("2909"),l=o("3835"),u=(o("99af"),o("4de4"),o("7db0"),o("caad"),o("d81d"),o("e9c4"),o("b64b"),o("d3b7"),o("2532"),o("3ca3"),o("ddb0"),o("bc3a")),d=o.n(u),f={data:function(){var e=JSON.parse(localStorage.getItem("allSubjects"))||[];return Array.isArray(e)?console.log("获取到的 subject 数据:",e):console.error("subject 数据格式不正确，期望是一个数组"),{courseNames:JSON.parse(localStorage.getItem("courseNames"))||[],selectedCourse:null,questions:[],selectedQuestions:[],previousSelectedQuestions:[],showUploadDialog:!1,form:{student_id:"",course_name:"",course_id:"",file:null}}},methods:{selectCourse:function(e){this.selectedCourse=e;var t=JSON.parse(localStorage.getItem("allSubjects"))||[],o=t.find((function(t){var o=t.split("_"),n=Object(l["a"])(o,2),s=n[1];return s===e}));o?(console.log("筛选出的 subject:",o),this.sendSubjectToBackend(o)):console.error("未找到与 courseName 对应的 subject")},sendSubjectToBackend:function(e){var t=this,o="http://api.xdrv.cn:52382/show_multiple_c/?subject=".concat(encodeURIComponent(e));console.log("发送到后端的 subject:",e),fetch(o,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){if(!e.ok)throw new Error("Network response was not ok: ".concat(e.statusText));return e.json()})).then((function(e){console.log("后端响应：",e),t.questions=Array.isArray(e.data)?e.data:[]})).catch((function(e){console.error("请求失败：",e)}))},handleSelectionChange:function(e){var t=this,o=e.filter((function(e){return!t.previousSelectedQuestions.includes(e)}));o.length>0&&this.uploadSelectedQuestions(o),this.selectedQuestions=e,this.previousSelectedQuestions=Object(i["a"])(e),console.log("选中的题目:",this.selectedQuestions)},uploadSelectedQuestions:function(e){var t=this,o=localStorage.getItem("student_id");if(!o)return console.error("未找到 student_id"),void alert("请先登录");var n=e.map((function(e){var n={question:e.question,options:[e.A,e.B,e.C,e.D],answer:e.answer,course_name:t.selectedCourse,difficulty:0,chapter:"默认章节",student_id:o};return console.log("上传题目的请求体:",n),fetch("http://api.xdrv.cn:52381/djangoZhiHuiShu/upload_question/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(e){if(!e.ok)throw new Error("HTTP error! Status: ".concat(e.status));return e.json()})).then((function(e){return console.log("题目上传成功:",e),e})).catch((function(e){throw console.error("题目上传失败:",e),e}))}));Promise.all(n).then((function(e){console.log("所有题目上传成功:",e)})).catch((function(e){console.error("部分题目上传失败:",e)}))},goToSaved:function(){this.$router.push("/custom-question-bank/saved")},handleFileChange:function(e){this.form.file=e.raw},submitForm:function(){var e=this;return Object(c["a"])(Object(r["a"])().mark((function t(){var o,n,s,c,i,u,f,p,h,m,v,g,b;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.form.course_name){t.next=3;break}return e.$message.error("请选择课程"),t.abrupt("return");case 3:if(e.form.file){t.next=6;break}return e.$message.error("请上传PDF文件"),t.abrupt("return");case 6:if(o=new FormData,o.append("file",e.form.file),n=JSON.parse(localStorage.getItem("courseNames")||"[]"),s=JSON.parse(localStorage.getItem("courseIds")||"[]"),c=JSON.parse(localStorage.getItem("student_id")||"[]"),i=n.indexOf(e.form.course_name),-1!==i){t.next=15;break}return e.$message.error("未找到对应的课程 ID"),t.abrupt("return");case 15:u=s[i],o.append("course_id",u),o.append("course_name",e.form.course_name),o.append("teacher_id",c),console.log("提交的表单内容："),f=Object(a["a"])(o.entries());try{for(f.s();!(p=f.n()).done;)h=Object(l["a"])(p.value,2),m=h[0],v=h[1],console.log("".concat(m,": ").concat(v))}catch(r){f.e(r)}finally{f.f()}return g=e.$loading({lock:!0,text:"上传中，请稍后...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t.prev=23,t.next=26,d.a.post("http://api.xdrv.cn:52381/djangoZhiHuiShu/deal_qa_file/",o,{headers:{"Content-Type":"multipart/form-data"}});case 26:b=t.sent,200===b.status&&e.$message.success(b.data.message),t.next=33;break;case 30:t.prev=30,t.t0=t["catch"](23),e.$message.error(t.t0.response.data.error||"服务器错误");case 33:return t.prev=33,g.close(),t.finish(33);case 36:case"end":return t.stop()}}),t,null,[[23,30,33,36]])})))()}},mounted:function(){this.fetchCourses()}},p=f,h=(o("04cd"),o("2877")),m=Object(h["a"])(p,n,s,!1,null,"69521471",null);t["default"]=m.exports},e9c4:function(e,t,o){var n=o("23e7"),s=o("d066"),r=o("d039"),a=s("JSON","stringify"),c=/[\uD800-\uDFFF]/g,i=/^[\uD800-\uDBFF]$/,l=/^[\uDC00-\uDFFF]$/,u=function(e,t,o){var n=o.charAt(t-1),s=o.charAt(t+1);return i.test(e)&&!l.test(s)||l.test(e)&&!i.test(n)?"\\u"+e.charCodeAt(0).toString(16):e},d=r((function(){return'"\\udf06\\ud834"'!==a("\udf06\ud834")||'"\\udead"'!==a("\udead")}));a&&n({target:"JSON",stat:!0,forced:d},{stringify:function(e,t,o){var n=a.apply(null,arguments);return"string"==typeof n?n.replace(c,u):n}})}}]);