(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-58eab724"],{f236:function(e,t,r){},f838:function(e,t,r){"use strict";r("f236")},fa13:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"upload-container"},[r("h2",[e._v("上传PDF文件并生成题目")]),r("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px"}},[r("el-form-item",{attrs:{label:"课程名称"}},[r("el-select",{attrs:{placeholder:"请选择课程"},on:{change:e.updateCourseId},model:{value:e.form.course_name,callback:function(t){e.$set(e.form,"course_name",t)},expression:"form.course_name"}},e._l(e.courseNames,(function(e,t){return r("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),r("el-form-item",{attrs:{label:"上传PDF文件"}},[r("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{"auto-upload":!1,"on-change":e.handleFileChange,limit:1,accept:".pdf"}},[r("div",{staticStyle:{display:"flex","justify-content":"flex-start"}},[r("el-button",{staticStyle:{width:"150px"},attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")])],1),r("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传PDF文件")])])],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("提交")])],1)],1)],1)},s=[],n=r("c7eb"),o=r("3835"),c=r("b85c"),u=r("1da1"),l=(r("99af"),r("d81d"),r("b64b"),r("d3b7"),r("ddb0"),r("bc3a")),i=r.n(l),d={data:function(){return{courseNames:[],form:{student_id:"",course_name:"",course_id:"",file:null}}},methods:{handleFileChange:function(e){this.form.file=e.raw},submitForm:function(){var e=this;return Object(u["a"])(Object(n["a"])().mark((function t(){var r,a,s,u,l,d,m,f,p,h,b,g,_;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.form.course_name){t.next=3;break}return e.$message.error("请选择课程"),t.abrupt("return");case 3:if(e.form.file){t.next=6;break}return e.$message.error("请上传PDF文件"),t.abrupt("return");case 6:if(r=new FormData,r.append("file",e.form.file),a=JSON.parse(localStorage.getItem("courseNames")||"[]"),s=JSON.parse(localStorage.getItem("courseIds")||"[]"),u=JSON.parse(localStorage.getItem("student_id")||"[]"),l=a.indexOf(e.form.course_name),-1!==l){t.next=15;break}return e.$message.error("未找到对应的课程 ID"),t.abrupt("return");case 15:d=s[l],r.append("course_id",d),r.append("course_name",e.form.course_name),r.append("teacher_id",u),console.log("提交的表单内容："),m=Object(c["a"])(r.entries());try{for(m.s();!(f=m.n()).done;)p=Object(o["a"])(f.value,2),h=p[0],b=p[1],console.log("".concat(h,": ").concat(b))}catch(n){m.e(n)}finally{m.f()}return g=e.$loading({lock:!0,text:"上传中，请稍后...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t.prev=23,t.next=26,i.a.post("http://api.xdrv.cn:52381/djangoZhiHuiShu/deal_qa_file/",r,{headers:{"Content-Type":"multipart/form-data"}});case 26:_=t.sent,200===_.status&&e.$message.success(_.data.message),t.next=33;break;case 30:t.prev=30,t.t0=t["catch"](23),e.$message.error(t.t0.response.data.error||"服务器错误");case 33:return t.prev=33,g.close(),t.finish(33);case 36:case"end":return t.stop()}}),t,null,[[23,30,33,36]])})))()},fetchCourses:function(){var e=this;return Object(u["a"])(Object(n["a"])().mark((function t(){var r,a,s,o;return Object(n["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=localStorage.getItem("token"),r){t.next=4;break}return e.$message.error("未找到有效的token，请先登录"),t.abrupt("return");case 4:return t.prev=4,a="https://sanrenxing.wihealth.com.cn/Course_selection/teacher_courses/",t.next=8,fetch(a,{method:"GET",headers:{Authorization:"Bearer ".concat(r)}});case 8:return s=t.sent,t.next=11,s.json();case 11:o=t.sent,o&&"success"===o.status&&Array.isArray(o.data)&&o.data.length>0?(e.courseNames=o.data.map((function(e){return e.course_name})),e.courseIds=o.data.map((function(e){return e.course_id})),e.form.course_id=e.courseIds[0]):e.$message.error("获取课程列表失败，请重试"),t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](4),e.$message.error("获取课程列表失败，请稍后重试");case 18:case"end":return t.stop()}}),t,null,[[4,15]])})))()}},mounted:function(){this.fetchCourses()}},m=d,f=(r("f838"),r("2877")),p=Object(f["a"])(m,a,s,!1,null,"db69e79c",null);t["default"]=p.exports}}]);